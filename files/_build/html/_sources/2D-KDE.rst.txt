#######################################
2D-KDE
#######################################

***************
What's this?
***************

Macro for two dementional kernel density estimation (2D-KDE) plot using SAS GRAPH.

2D-KDE will show as contour plot with marginal KDE curve

*****************
Input data
*****************


.. csv-table:: 

   "**key**", "**variable** ", "**type**"
   "1","group","numeric"
   "2","x", "numeric"
   "","y", "numeric"

I recommended that format is applied to group variable.


***************
Syntax
***************

 ::

   ods graphics / < graphics option > ;
   ods listing gpath=< output path >;

%macro kde2d(
         data=,
         group=None,
         x=,
         y=,
         xlabel=x,
         ylabel=y,
         univar_grid=401,
         bw_method=sjpi,
         bw_adjust=1,
         univar_style=line,
         bivar_grid=60,
         bivar_nlevel=10,
         bivar_style=line,
         thresh=0.001,
         legend=true,
         scatter=false,
         palette=sns

);



***************
Parameters
***************
- **data : dataset name (required)**

   input data. keep, rename and  where options are available.

- **group : variable name (required)**

   group variable. number of groups  must be two.

- **x : variable name (required)**

   level variable or midpoint of bins

- **y : variable name (required)**

   response variable

- **xlabel : string (optional)**

   label string of x-axis.
   default is "x". when the label is not displayed , set like below.

   xlabel=,

- **ylabel : string (optional)**

   optional. label string of y-axis.
   default is "y". when the label is not displayed , set like below.

   ylabel=,

- **univar_grid : integer (optional)**

   the number of univariate KDE gridsize.
   default is 401 (the default of proc kde)


- **bw_method : keyword (optional)**

   the bandwidth estimation method of univariate KDE.
   default is "sjpi" (the default of proc kde).

   method keyword described below is available.

      * sjpi (Sheather-Jones plug-in)
      * snr (simple normal reference)
      * snrq (simple normal reference that uses the interquartile range)
      * srot (Silverman's rule of thumb)
      * os (oversmoothed)

- **bw_adjust : numeric (optional)**

   the bandwidth multiplier of univariate KDE. Increasing will make the curve smoother.
   the default is 1. 

- **univar_style : keyword (optional)**

   the style of univariate KDE. style keyword described below is available.
      * line
      * fill

- **bivar_grid : integer (optional)**

   the number of bivariate KDE gridsize.
   default is 60 (the default of proc kde).

- **bivar_nlevel : integer (optional)**

   the number of level for bivariate KDE.
   default is 10.

- **bivar_style : keyword (optional)**

   the style of bivariate KDE. style keyword described below is available.
      * line
      * fill
      * linefill

- **thresh : integer (0 to 1, optional)**

   the density threhold of bivariate KDE. The grid that density is under the threhold will removed from the bivariate KDE plot.
   default is 0.001.

- **scatter : bool (optional)**
- 
   if True the scatter plot will be displayed.
   default is False.

- **rug : bool (optional)**
- 
   if True the rug plot will be displayed on the univariate KDE plot.
   default is False.

- **legend : bool (optional)**

   if "True" , legend of group item is displayed.
   default is "True".

- **pallete : keyword (optional)**
- 
   color palette for fill, line and markers. the palletes described below is available.
   see color palette section of introduction page. defalut is "SNS" (Seaborn defalut palette).

      * SAS
      * SNS (Seaborn)
      * STATA
      * TABLEAU



***************
example
***************

grouped KDE plot
=======================

if the group parameter is set, univariate KDE and bivariate KDE plot will be generated by group. Group color is depend on the color palette set by palette parameter.

code ::
   ods listing gpath=<your path>;
   ods graphics /  height=24cm width=24cm imagename="groupedKDE" imagefmt=svg;

   %kde2d(
   dat=penguins,
   x=bill_length_mm,
   y=bill_depth_mm,
   group=species2,
   univar_style=line,
   bivar_nlevel=10,
   bivar_style=line,
   bivar_grid=100,
   xlabel=bill_length (mm),
   ylabel=bill_depth (mm),
   legend=true,
   palette=sns
   );


.. image:: ./img/groupedKDE.svg

Style of KDE plot
=======================

Univariate KDE plot is supported two styles, LINE, and FILL. these styles can be set by univar_style parameter.
Bivariate KDE plot is supported three styles, LINE, FILL, and LINEFILL. these styles can be set by bivar_style parameter.

Because FILL and LINEFILL styles can not be adjust the transparency of the fill, the overlapped grouped KDE plot with FILL style or LINEFILL style is not recommended.

code ::
   ods listing gpath=<your path>;
   ods graphics /  height=24cm width=24cm imagename="linefillKDE" imagefmt=svg;

   %kde2d(
   dat=penguins(where=(species2=2)),
   x=bill_length_mm,
   y=bill_depth_mm,
   group=species2,
   univar_style=fill,
   bivar_nlevel=10,
   bivar_style=linefill,
   bivar_grid=100,
   xlabel=bill_length (mm),
   ylabel=bill_depth (mm),
   legend=true,
   palette=sns
   );

.. image:: ./img/linefillKDE.svg

scatter plot
=======================

