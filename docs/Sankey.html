<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sankey diagram (Alluvial Diagram) &mdash; SAS Plotter 1.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MultiHistogram" href="Multihistogram.html" />
    <link rel="prev" title="2D-KDE" href="2D-KDE.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SAS Plotter
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Raincloud_plot.html">Raincloud plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="Raincloud_plot_paired.html">Raincloud plot (paired)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ridgeline_plot.html">Ridgeline plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mirrored_histogram.html">Mirrored Histogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="2D-KDE.html">2D-KDE</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sankey diagram (Alluvial Diagram)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-s-this">What’s this?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#elements-of-sankey-diagram">Elements of Sankey diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rules">Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#input-data">Input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#domain-settings">Domain settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-settings">Node settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#link-settings">Link settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-settings">Other settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example">example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-sankey-diagram">Basic sankey diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjust-the-domain-interval">Adjust the domain interval</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-format-and-legend">Node format and legend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#change-the-fill-appearance">Change the fill appearance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#change-the-text-appearance">Change the text appearance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#focus-parameter">Focus parameter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-1-links-whose-source-node-is-1-drug-a">example 1: links whose source_node is 1 (Drug A)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-2-links-whose-target-node-is-5-lost-to-followup">example 2: links whose target_node is 5 (Lost to followup)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-3-links-whose-domain-is-2-day-30">example 3: links whose domain is 2 (Day 30)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-4-multiple-condition">example 4: multiple condition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#percentage-of-followup">Percentage of Followup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Multihistogram.html">MultiHistogram</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SAS Plotter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sankey diagram (Alluvial Diagram)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Sankey.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="sankey-diagram-alluvial-diagram">
<h1>Sankey diagram (Alluvial Diagram)<a class="headerlink" href="#sankey-diagram-alluvial-diagram" title="Permalink to this heading"></a></h1>
<div class="section" id="what-s-this">
<h2>What’s this?<a class="headerlink" href="#what-s-this" title="Permalink to this heading"></a></h2>
<p>Macro for Sankey diagram using SAS GRAPH.</p>
<p>To be more precise, it is called alluvial Diagram.</p>
<p>A Sankey diagram is a visualization used to depict a flow from one domain of values to another domain.
Sankey graphs is useful for showing flow and relationships among multiple categories.</p>
<p>In pharmacoepidemiology study, this diagram is used for changes of the state of a patient over time, such as medication switching, disease stage progression,
or movement through treatment pathways. <a class="footnote-reference brackets" href="#footcite-https-doi-org-10-1002-pds-5529" id="id1">1</a>.</p>
<p>In the past, there are reports of sankey diagram example using SAS GRAPH <a class="footnote-reference brackets" href="#footcite-barchartsankey" id="id2">2</a><a class="footnote-reference brackets" href="#footcite-sasofficialsankey" id="id3">3</a>.
But in this macro, more options such as statistics display and node focus are available.</p>
<p>If you can allow the use of HTML, I suggest you refer to the case study of using D3.js and SAS <a class="footnote-reference brackets" href="#footcite-sankeywithsasandd3js" id="id4">4</a>.</p>
<div class="section" id="elements-of-sankey-diagram">
<h3>Elements of Sankey diagram<a class="headerlink" href="#elements-of-sankey-diagram" title="Permalink to this heading"></a></h3>
<p>Sankey diagram is contained the three elements.</p>
<img alt="_images/elements_of_sankey_diagram.png" src="_images/elements_of_sankey_diagram.png" />
<ul>
<li><p>domain</p>
<blockquote>
<div><p>the group of data as x-axis</p>
</div></blockquote>
</li>
<li><p>Node</p>
<blockquote>
<div><p>the category. displays as rectangle shape.</p>
</div></blockquote>
</li>
<li><p>link (flow)</p>
<blockquote>
<div><p>sigmoid shapes connected from node (source node) to next node (target node). amounts of flow are displays as widths of sigmoid shapes.
the links connect the nodes in order left domain to right domain.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="rules">
<h3>Rules<a class="headerlink" href="#rules" title="Permalink to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p>the nodes are stacked in node category order.</p></li>
<li><p>all records of the input data are displayed in the all domains.</p></li>
<li><p>nodes in the first domain should be source node only, not target node.</p></li>
<li><p>the nodes of last domain should be target node only, not source node.</p></li>
<li><p>Circular links are not allowed.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="input-data">
<h2>Input data<a class="headerlink" href="#input-data" title="Permalink to this heading"></a></h2>
<p>the node categories are set to each domain variables like below.
I recommended that the node category format is applied to each domain variable.
the domain variables should be numeric.</p>
<p>null value is allowed. null value is defined as null node and same as other nodes.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>domain1</strong></p></td>
<td><p><strong>domain2</strong></p></td>
<td><p><strong>domain3</strong></p></td>
</tr>
<tr class="row-even"><td><p>node A</p></td>
<td><p>node B</p></td>
<td><p>node C</p></td>
</tr>
<tr class="row-odd"><td><p>node B</p></td>
<td><p>node A</p></td>
<td><p>node C</p></td>
</tr>
<tr class="row-even"><td><p>node D</p></td>
<td><p>node A</p></td>
<td><p>node B</p></td>
</tr>
</tbody>
</table>
<p>the domain format is required.</p>
<p>code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proc</span> <span class="nb">format</span><span class="p">;</span>
  <span class="n">value</span> <span class="n">domainfmt</span>
  <span class="mi">1</span><span class="o">=</span><span class="s2">&quot;Domain 1&quot;</span>
  <span class="mi">2</span><span class="o">=</span><span class="s2">&quot;Domain 2&quot;</span>
  <span class="mi">3</span><span class="o">=</span><span class="s2">&quot;Domain 3&quot;</span>
<span class="p">;</span>
<span class="n">run</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">ods</span> <span class="n">graphics</span> <span class="o">/</span> <span class="o">&lt;</span> <span class="n">graphics</span> <span class="n">option</span> <span class="o">&gt;</span> <span class="p">;</span>
 <span class="n">ods</span> <span class="n">listing</span> <span class="n">gpath</span><span class="o">=&lt;</span> <span class="n">output</span> <span class="n">path</span> <span class="o">&gt;</span><span class="p">;</span>

<span class="o">%</span><span class="n">macro</span> <span class="n">sankey</span><span class="p">(</span>
   <span class="n">data</span><span class="o">=</span><span class="p">,</span>

   <span class="n">domain</span><span class="o">=</span><span class="p">,</span>
   <span class="n">domainfmt</span><span class="o">=</span><span class="p">,</span>
   <span class="n">domaintextattrs</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">black</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">),</span>
   <span class="n">gap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>

   <span class="n">nodefmt</span><span class="o">=</span><span class="n">auto</span><span class="p">,</span>
   <span class="n">nodewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
   <span class="n">nodeattrs</span><span class="o">=</span><span class="n">auto</span><span class="p">,</span>
   <span class="n">nodename</span><span class="o">=</span><span class="n">true</span><span class="p">,</span>
   <span class="n">nodetextattrs</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">black</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">),</span>

   <span class="n">linktext</span><span class="o">=</span><span class="n">true</span><span class="p">,</span>
   <span class="n">linktext_offset</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
   <span class="n">linkattrs</span><span class="o">=</span><span class="n">auto</span><span class="p">,</span>
   <span class="n">linktextattrs</span><span class="o">=</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">black</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>

   <span class="n">reverse</span><span class="o">=</span><span class="n">false</span><span class="p">,</span>
   <span class="n">focus</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">endFollowup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="n">stat</span><span class="o">=</span><span class="n">both</span><span class="p">,</span>
   <span class="n">unit</span><span class="o">=</span><span class="p">,</span>

   <span class="n">legend</span><span class="o">=</span><span class="n">false</span><span class="p">,</span>
   <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="p">,</span>
   <span class="n">note</span><span class="o">=</span><span class="p">,</span>
   <span class="n">deletedata</span><span class="o">=</span><span class="n">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h2>
<ul>
<li><p><strong>data : dataset name (required)</strong></p>
<blockquote>
<div><p>input data. keep and rename options are available but keep option is not.
input data is copied to work library and keep only domain variable set to domain parameter.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="domain-settings">
<h3>Domain settings<a class="headerlink" href="#domain-settings" title="Permalink to this heading"></a></h3>
<ul>
<li><p><strong>domain : variable name (required)</strong></p>
<blockquote>
<div><p>domain variable. domain variables are set in link order.
for example, if domain parameter is set as “var1 var2 var3”, the var1 and var2, var2 and var3 are connected.</p>
</div></blockquote>
</li>
<li><p><strong>domainfmt : variable name (required)</strong></p>
<blockquote>
<div><p>format for domain variable. format catalog should be saved in work library and value should be numeric.
interval of domains is depends on the values of format. labels of the format are displayed on plot.
values not be included into sankey should be exclude from format.</p>
</div></blockquote>
</li>
<li><p><strong>domaintextattrs : text appearance (optional)</strong></p></li>
<li><p>The appearance (font size, font color and font weights) of domain text. it is same as textattrs of GTL. default is “(size=11 color=black).</p></li>
</ul>
</div>
<div class="section" id="node-settings">
<h3>Node settings<a class="headerlink" href="#node-settings" title="Permalink to this heading"></a></h3>
<ul>
<li><p><strong>gap : numeric (optional)</strong></p>
<blockquote>
<div><p>the gap between nodes. default is 5.</p>
</div></blockquote>
</li>
<li><p><strong>nodefmt : keyword or format name (optional)</strong></p>
<blockquote>
<div><p>format for nodes. if “auto” is set, format is obtained from domain variable in input data.
if you want to display the node which is not existed in input data in the legend. the node format should be set to this parameter. format catalog should be saved in work library.
default is “auto”.</p>
</div></blockquote>
</li>
<li><p><strong>nodewidth : numeric (optional)</strong></p>
<blockquote>
<div><p>the width of node shapes. the default is 0.2.</p>
</div></blockquote>
</li>
</ul>
<img alt="_images/nodewidth.png" src="_images/nodewidth.png" />
<ul>
<li><p><strong>nodeattrs : keyword or fill appearance  (optional)</strong></p>
<blockquote>
<div><p>node appearance (color, transparency). it is same as fillattrs option of GTL.
if “auto” is set, the fill color of nodes are set based on the node category.
if you want to be set same color to all the nodes.fill attribute is set to this parameter.</p>
<p>for example, the fill appearance described below is set and the all nodes is set blue.</p>
<p>nodeattrs=(color=blue)</p>
<p>default is “auto”.</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt><strong>nodename : bool (optional)</strong></dt><dd><p>displays the node name (node category name) in the sankey diagram.
default is “true”.</p>
</dd>
</dl>
</li>
<li><p><strong>nodetextattrs : text appearance  (optional)</strong></p>
<blockquote>
<div><p>The node text appearance (font size, font color and font weights).
It is same as textattrs option of GTL.
default is “(size=9 color=black).</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="link-settings">
<h3>Link settings<a class="headerlink" href="#link-settings" title="Permalink to this heading"></a></h3>
<ul>
<li><p><strong>linkattrs : fill appearance (optional)</strong></p>
<blockquote>
<div><p>fill appearance of link shapes (color, transparency). it is same as fillattrs option of GTL. if the fill appearance is set to this parameter, all the links will be applied.
default is “auto”. fill color is defined as source node type.</p>
</div></blockquote>
</li>
<li><p><strong>linktext : bool (optional)</strong></p>
<blockquote>
<div><p>display the link text (frequency or percentage). the text will be displays at the source node side of the links.default is “true”.</p>
</div></blockquote>
</li>
<li><p><strong>linktext_offset : numeric (optional)</strong></p>
<blockquote>
<div><p>the gap between node shape and link text.
default is 0.15.</p>
</div></blockquote>
</li>
</ul>
<img alt="_images/linktext_offset.png" src="_images/linktext_offset.png" />
<ul>
<li><p><strong>linktextattrs : text appearance  (optional)</strong></p>
<blockquote>
<div><p>the appearance (font size, font color and font weights) of link text. It is same as textattrs option of GTL.
default is “(size=8 color=black).</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="other-settings">
<h3>Other settings<a class="headerlink" href="#other-settings" title="Permalink to this heading"></a></h3>
<ul>
<li><p><strong>reverse : bool (optional)</strong></p>
<blockquote>
<div><p>if True the y-axis will be reversed. default is False.</p>
</div></blockquote>
</li>
<li><p><strong>focus : subset-if statement (optional)</strong></p>
<blockquote>
<div><p>specify the focused links. The links except for focused links will be set grey color and link text will be not displayed.
The focused links are specified by nodes connected by focused links using subset if statement.
variables that can be used for subset if are as follows.</p>
<blockquote>
<div><ul class="simple">
<li><p>domain: domain of source_node</p></li>
<li><p>next_domain:  domain of target_node</p></li>
<li><p>source_node: source node of focused link</p></li>
<li><p>target_node: target node of focused link</p></li>
</ul>
</div></blockquote>
<p>for example, when links connected from “type A” node (source node) of domain 2 is focused, set the parameter described below. value of type A node is 1.</p>
<p>focus=(source_node=1 and domain=2)</p>
<p>default is “none” (not focused).</p>
</div></blockquote>
</li>
<li><p><strong>EndFollowup : node (optional)</strong></p>
<blockquote>
<div><p>specify the node of end of follow-up.
The color of node specified this parameter will be set grey and the percentage of follow-up at each domain will be displayed at the bottom of Sankey diagram.
default is “none” (not specified).</p>
<p>the percentage of follow-up is calculated using following equation.</p>
<p>%follow-up = (total number - number of EndFollowup) / Total number * 100</p>
</div></blockquote>
</li>
<li><p><strong>stat : keyword (optional)</strong></p>
<blockquote>
<div><p>displays the frequency or percentage of nodes and links.
the keyword described below is available. default is “both”.</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><p>FREQ: frequency</p></li>
<li><p>PCT:  percentage(displays second decimal place)</p></li>
<li><p>BOTH: frequency and percentage</p></li>
<li><p>NONE: not displayed</p></li>
</ul>
</div></blockquote>
<p>the percentage is calculated using following equation.</p>
<p>percentage = frequency of nodes or links / number observation of input data * 100</p>
</div></blockquote>
</div></blockquote>
</li>
<li><p><strong>unit : text (optional)</strong></p>
<blockquote>
<div><p>the units of frequency (suffix). if “FREQ” or “BOTH” keyword is set to the stat parameter,
the units of frequency is displayed in the node text and link text.</p>
<p>default is “” (null).</p>
</div></blockquote>
</li>
<li><p><strong>legend : bool (optional)</strong></p>
<blockquote>
<div><p>if “True” the legend of node category item is displayed.
default is “false”.</p>
</div></blockquote>
</li>
<li><p><strong>palette : keyword (optional)</strong></p>
<blockquote>
<div><p>color palette for fill, line and markers. the palettes described below is available.
see color palette section of introduction page. default is “SNS” (Seaborn default palette).</p>
<blockquote>
<div><ul class="simple">
<li><p>SAS</p></li>
<li><p>SNS (Seaborn)</p></li>
<li><p>STATA</p></li>
<li><p>TABLEAU</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p><strong>note : statement (optional)</strong></p>
<blockquote>
<div><p>insert the text entry statement into the graph template and display the title or footnote in the output image.
default is “” (not displayed)</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt><strong>deletedata : bool (optional)</strong></dt><dd><p>if True, the temporary datasets and catalogs generated by macros will be deleted at the end of execution.
default is True.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="example">
<h2>example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h2>
<p>output example can be executed using following code after loading SAS plotter.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods listing gpath=<span class="s">&quot;your output path&quot;</span>;
<span class="k">filename</span> exam url <span class="s">&quot;https://github.com/Superman-jp/SAS_Plotter/raw/main/example/sankey_example.sas&quot;</span> encoding=<span class="s">&#39;UTF-8&#39;</span>;
<span class="nf">%include</span> exam;
</pre></div>
</div>
<div class="section" id="basic-sankey-diagram">
<h3>Basic sankey diagram<a class="headerlink" href="#basic-sankey-diagram" title="Permalink to this heading"></a></h3>
<p>the regimen changes of the patients is displayed as sankey diagram using this macro.
variables (day0, day30, day60, day120) are selected regimen of the patient at 0 ,30, 60 and 120days.
these variables is set the regimen types.</p>
<p>raw data</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span><span class="kr">proc format;</span>
value domainf
<span class="m">1</span>=<span class="s">&quot;day0&quot;</span>
<span class="m">2</span>=<span class="s">&quot;day30&quot;</span>
<span class="m">3</span>=<span class="s">&quot;day60&quot;</span>
<span class="m">4</span>=<span class="s">&quot;day120&quot;</span>;

value nodef
<span class="m">0</span>=<span class="s">&quot;Drug A&quot;</span>
<span class="m">1</span>=<span class="s">&quot;Drug B&quot;</span>
<span class="m">2</span>=<span class="s">&quot;Drug C&quot;</span>
<span class="m">3</span>=<span class="s">&quot;Drug D&quot;</span>
<span class="m">4</span>=<span class="s">&quot;Drug E&quot;</span>
<span class="kr">;</span>
<span class="kr">run;</span>
<span class="kr">data </span>raw;
usubjid<span class="m">+1</span>;
<span class="k">input</span> day0 day30 day60 day120;
<span class="k">format</span> day0 day30 day60 day120 nodef.;
<span class="k">cards;</span>
<span class="x">0 2 3 4</span>
<span class="x">0 2 3 4</span>
<span class="x">0 2 3 4</span>
<span class="x">2 1 2 4</span>
<span class="x">2 1 2 4</span>
<span class="x">2 1 2 4</span>
<span class="x">2 1 2 4</span>
<span class="x">2 1 2 4</span>
<span class="x">2 1 4 3</span>
<span class="x">4 3 2 1</span>
<span class="x">4 3 2 1</span>
<span class="x">4 3 2 1</span>
<span class="x">4 3 2 1</span>
<span class="x">;</span>
<span class="kr">run;</span>
</pre></div>
</div>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_basic&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;Bacic Sankey&quot;</span>;

<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day30 day60 day120,
   domainfmt=domainf,
   note=<span class="nb">%nrstr</span>(entrytitle <span class="s">&#39;your title here&#39;</span>;
            entryfootnote halign=left <span class="s">&#39;your footnote here&#39;</span>;
            entryfootnote halign=left <span class="s">&#39;your footnote here 2&#39;</span>;)
   );
</pre></div>
</div>
<img alt="_images/sankey_basic1.svg" src="_images/sankey_basic1.svg" /></div>
<div class="section" id="adjust-the-domain-interval">
<h3>Adjust the domain interval<a class="headerlink" href="#adjust-the-domain-interval" title="Permalink to this heading"></a></h3>
<p>The interval of the domain is defined as the values of the domain format.
when the domain format values are adjusted, then interval of the domain will be changed.</p>
<p>if the format is changed described below, the plot of the previous section “basic sankey diagram”
is as follows.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span><span class="kr">proc format;</span>
value domain2f
<span class="m">1</span>=<span class="s">&quot;day0&quot;</span>
<span class="m">2</span>=<span class="s">&quot;day30&quot;</span>
<span class="m">3</span>=<span class="s">&quot;day60&quot;</span>
<span class="m">5</span>=<span class="s">&quot;day120&quot;</span><span class="kr">;</span>
<span class="kr">run;</span>

ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_change_intervals&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;Adjust the domain interval&quot;</span>;
ods html;
<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day30 day60 day120,
   domainfmt=domain2f
);
</pre></div>
</div>
<img alt="_images/sankey_change_intervals1.svg" src="_images/sankey_change_intervals1.svg" /></div>
<div class="section" id="node-format-and-legend">
<h3>Node format and legend<a class="headerlink" href="#node-format-and-legend" title="Permalink to this heading"></a></h3>
<p>If the codes of the previous section “basic sankey diagram” is changed as described below, the color of the “Regimen E”, “Regimen G” and
“Regimen I” is different from the previous section.</p>
<p>By default, the color of the nodes is defined based on the input data and domain variables.
when the input dataset is modified, the color of the nodes might be changed even though same node.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span><span class="kr">proc format;</span>
value domain3f
<span class="m">1</span>=<span class="s">&quot;day0&quot;</span>
<span class="m">2</span>=<span class="s">&quot;day60&quot;</span>
<span class="kr">;</span>
<span class="kr">run;</span>
ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_not_set_nodefmt&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;not set nodefmt parameter&quot;</span>;

<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day60,
   domainfmt=domain3f,
   legend=true
);
</pre></div>
</div>
<img alt="_images/sankey_not_set_nodefmt1.svg" src="_images/sankey_not_set_nodefmt1.svg" /><p>if nodefmt parameter is set, the color of the nodes defined based on the node format. The node color is independent from dataset.
All elements of the format is displayed in the legend if legend parameter is true.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_set_nodefmt&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;set nodefmt parameter&quot;</span>;

<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day60,
   domainfmt=domain3f,
   nodefmt=nodef,
   legend=true
);
</pre></div>
</div>
<img alt="_images/sankey_set_nodefmt1.svg" src="_images/sankey_set_nodefmt1.svg" /></div>
<div class="section" id="change-the-fill-appearance">
<h3>Change the fill appearance<a class="headerlink" href="#change-the-fill-appearance" title="Permalink to this heading"></a></h3>
<p>By default, the node color and the link color are defined based on the node category.
If the nodeattrs or linkattrs are set, the fill color of the all the nodes or links will be changed.
Nodefmt parameter will be ignored.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_set_nodeattrs&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;change_the_node color&quot;</span>;
ods html;
<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day30 day60 day120,
   domainfmt=domainf,
   nodeattrs=(color=grey)
);
</pre></div>
</div>
<img alt="_images/sankey_set_nodeattrs1.svg" src="_images/sankey_set_nodeattrs1.svg" /><p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_set_linkattrs&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;change the link color&quot;</span>;
ods html;
<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day30 day60 day120,
   domainfmt=domainf,
   linkattrs=(color=skyblue transparency=<span class="m">0.7</span>)
);
</pre></div>
</div>
<img alt="_images/sankey_set_linkattrs1.svg" src="_images/sankey_set_linkattrs1.svg" /></div>
<div class="section" id="change-the-text-appearance">
<h3>Change the text appearance<a class="headerlink" href="#change-the-text-appearance" title="Permalink to this heading"></a></h3>
<p>The domaintextattrs, nodetextattrs and linktextattrs parameters are useful for modify text appearance of
domains, nodes and links.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_set_textattrs&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;change the text appearance&quot;</span>;
ods html;
<span class="nf">%sankey</span>(
   data=raw,
   domain=day0 day30 day60 day120,
   domainfmt=domainf,
   domaintextattrs=(color=red size=<span class="m">12</span>),
   nodetextattrs=(color=blue size=<span class="m">12</span>),
   linktext_offset=<span class="m">0.05</span>,
   linktextattrs=(color=green size=<span class="m">8</span>)
);
</pre></div>
</div>
<img alt="_images/sankey_set_textattrs1.svg" src="_images/sankey_set_textattrs1.svg" /></div>
<div class="section" id="focus-parameter">
<h3>Focus parameter<a class="headerlink" href="#focus-parameter" title="Permalink to this heading"></a></h3>
<p>The focus parameter is useful for the highlighting specified links.
The not-highlighted links are set grey color and the link texts are not displayed.</p>
<p>focus links are specified by nodes connected by focus links and
the nodes is specified conditional statement (subset-if).</p>
<p>the nodes described below are available to specify the focus links.</p>
<p>raw data</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span><span class="kr">proc format;</span>

value druglist
<span class="m">1</span>=<span class="s">&quot;Drug A&quot;</span>
<span class="m">2</span>=<span class="s">&quot;Drug B&quot;</span>
<span class="m">3</span>=<span class="s">&quot;Drug C&quot;</span>
<span class="m">4</span>=<span class="s">&quot;Drug D&quot;</span>
<span class="m">99</span>=<span class="s">&quot;Lost to follow-up&quot;</span>;

value timef
<span class="m">1</span>=<span class="s">&quot;Day 0&quot;</span>
<span class="m">2</span>=<span class="s">&quot;Day 30&quot;</span>
<span class="m">3</span>=<span class="s">&quot;Day 60&quot;</span>
<span class="m">4</span>=<span class="s">&quot;day 90&quot;</span>
<span class="kr">;</span>
<span class="kr">run;</span>

<span class="kr">data </span>drug_switch;
<span class="k">length</span> usubjid $<span class="m">10</span> Day0 Day30 Day60 Day90 <span class="m">8</span>;
<span class="k">format</span> Day0 Day30 Day60 Day90 druglist.;
<span class="k">input</span> usubjid $ Day0 Day30 Day60 Day90;
<span class="k">datalines;</span>
<span class="x">A001 1 1 1 3</span>
<span class="x">A002 1 1 1 4</span>
<span class="x">A003 1 1 1 4</span>
<span class="x">A004 1 1 1 4</span>
<span class="x">A005 1 2 1 4</span>
<span class="x">A006 1 3 1 4</span>
<span class="x">A007 1 3 1 4</span>
<span class="x">A008 1 4 1 99</span>
<span class="x">A009 1 4 1 99</span>
<span class="x">A010 1 1 2 2</span>
<span class="x">A011 1 1 2 3</span>
<span class="x">A012 1 1 2 3</span>
<span class="x">A013 1 1 2 3</span>
<span class="x">A014 1 2 2 4</span>
<span class="x">A015 1 2 2 4</span>
<span class="x">A016 1 3 2 4</span>
<span class="x">A017 1 1 3 1</span>
<span class="x">A018 1 1 3 2</span>
<span class="x">A019 1 2 3 4</span>
<span class="x">A020 1 2 3 4</span>
<span class="x">A021 1 2 3 4</span>
<span class="x">A022 1 3 3 4</span>
<span class="x">A023 1 3 3 99</span>
<span class="x">A024 2 4 2 4</span>
<span class="x">A025 2 1 3 3</span>
<span class="x">A026 2 1 3 3</span>
<span class="x">A027 2 1 4 1</span>
<span class="x">A028 2 1 4 2</span>
<span class="x">A029 2 2 4 3</span>
<span class="x">A030 2 2 4 4</span>
<span class="x">A031 2 2 4 4</span>
<span class="x">A032 2 3 4 4</span>
<span class="x">A033 2 3 4 4</span>
<span class="x">A034 2 99 99 99</span>
<span class="x">A035 2 99 99 99</span>
<span class="x">A036 3 1 4 2</span>
<span class="x">A037 3 2 4 4</span>
<span class="x">A038 3 3 4 99</span>
<span class="x">A039 3 1 99 99</span>
<span class="x">A040 3 1 99 99</span>
<span class="x">A041 3 99 99 99</span>
<span class="x">A042 4 4 3 99</span>
<span class="x">A043 4 1 99 99</span>
<span class="x">A044 4 2 99 99</span>
<span class="x">;</span>
<span class="kr">run;</span>
</pre></div>
</div>
<div class="section" id="example-1-links-whose-source-node-is-1-drug-a">
<h4>example 1: links whose source_node is 1 (Drug A)<a class="headerlink" href="#example-1-links-whose-source-node-is-1-drug-a" title="Permalink to this heading"></a></h4>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_focus1&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;focus parameter example 1&quot;</span>;
<span class="nf">%sankey</span>(
   data=drug_switch,
   domain=day0 day30 day60 day90,
   domainfmt=timef,
   focus=(source_node=<span class="m">1</span>),
   gap=<span class="m">1</span>,
   reverse=true,
   nodewidth=<span class="m">0.1</span>,
   nodename=false,
   stat=freq,
   legend=true,
   linktext_offset=<span class="m">0.03</span>,
   palette=sns
);
</pre></div>
</div>
<img alt="_images/sankey_focus11.svg" src="_images/sankey_focus11.svg" /></div>
<div class="section" id="example-2-links-whose-target-node-is-5-lost-to-followup">
<h4>example 2: links whose target_node is 5 (Lost to followup)<a class="headerlink" href="#example-2-links-whose-target-node-is-5-lost-to-followup" title="Permalink to this heading"></a></h4>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_focus2&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;focus parameter example 2&quot;</span>;
<span class="nf">%sankey</span>(
   data=drug_switch,
   domain=day0 day30 day60 day90,
   domainfmt=timef,
   focus=(target_node=<span class="m">99</span>),
   gap=<span class="m">1</span>,
   reverse=true,
   nodewidth=<span class="m">0.1</span>,
   nodename=false,
   stat=freq,
   legend=true,
   linktext_offset=<span class="m">0.03</span>,
   palette=sns);
</pre></div>
</div>
<img alt="_images/sankey_focus21.svg" src="_images/sankey_focus21.svg" /></div>
<div class="section" id="example-3-links-whose-domain-is-2-day-30">
<h4>example 3: links whose domain is 2 (Day 30)<a class="headerlink" href="#example-3-links-whose-domain-is-2-day-30" title="Permalink to this heading"></a></h4>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_focus3&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;focus parameter example 3&quot;</span>;

<span class="nf">%sankey</span>(
   data=drug_switch,
   domain=day0 day30 day60 day90,
   domainfmt=timef,
   focus=(domain=<span class="m">2</span>),
   gap=<span class="m">1</span>,
   reverse=true,
   nodewidth=<span class="m">0.1</span>,
   nodename=false,
   stat=freq,
   legend=true,
   linktext_offset=<span class="m">0.03</span>,
   palette=sns);
</pre></div>
</div>
<img alt="_images/sankey_focus31.svg" src="_images/sankey_focus31.svg" /></div>
<div class="section" id="example-4-multiple-condition">
<h4>example 4: multiple condition<a class="headerlink" href="#example-4-multiple-condition" title="Permalink to this heading"></a></h4>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_focus4&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;focus parameter example 4&quot;</span>;
<span class="nf">%sankey</span>(
   data=drug_switch,
   domain=day0 day30 day60 day90,
   domainfmt=timef,
   focus=((domain=<span class="m">1</span> <span class="k">and</span> source_node=<span class="m">2</span>) <span class="k">or</span> (next_domain=<span class="m">4</span> <span class="k">and</span> target_node=<span class="m">99</span>)),
   gap=<span class="m">1</span>,
   reverse=true,
   nodewidth=<span class="m">0.1</span>,
   nodename=false,
   stat=freq,
   legend=true,
   linktext_offset=<span class="m">0.03</span>,
   palette=sns);
</pre></div>
</div>
<img alt="_images/sankey_focus41.svg" src="_images/sankey_focus41.svg" /></div>
</div>
<div class="section" id="percentage-of-followup">
<h3>Percentage of Followup<a class="headerlink" href="#percentage-of-followup" title="Permalink to this heading"></a></h3>
<p>when the endfollowup parameter is set value of lost followup,
percentage followup each domain will be displayed below the sankey diagram.</p>
<p>code</p>
<div class="highlight-SAS notranslate"><div class="highlight"><pre><span></span>ods graphics / height=15cm width=20cm imagefmt=png imagename=<span class="s">&quot;sankey_endfollowup&quot;</span> noborder;
<span class="k">title</span> <span class="s">&quot;percentage of Followup&quot;</span>;
<span class="nf">%sankey</span>(
   data=drug_switch,
   domain=day0 day30 day60 day90,
   domainfmt=timef,
   gap=<span class="m">1</span>,
   reverse=true,
   nodewidth=<span class="m">0.1</span>,
   nodename=false,
   endfollowup=<span class="m">99</span>,
   stat=freq,
   legend=true,

   note=<span class="nb">%nrstr</span>(entrytitle <span class="s">&#39;your title here&#39;</span>;
               entryfootnote halign=left <span class="s">&#39;your footnote here&#39;</span>;
            entryfootnote halign=left <span class="s">&#39;your footnote here 2&#39;</span>;)
);
</pre></div>
</div>
<img alt="_images/sankey_endfollowup1.svg" src="_images/sankey_endfollowup1.svg" /></div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this heading"></a></h2>
<div class="docutils container" id="id5">
<dl class="footnote brackets">
<dt class="label" id="footcite-https-doi-org-10-1002-pds-5529"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Nicolle M. Gatto, Shirley V. Wang, William Murk, Pattra Mattox, M. Alan Brookhart, Andrew Bate, Sebastian Schneeweiss, and Jeremy A. Rassen. Visualizations throughout pharmacoepidemiology study planning, implementation, and reporting. <em>Pharmacoepidemiology and Drug Safety</em>, 31(11):1140–1152, 2022. URL: <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.1002/pds.5529">https://onlinelibrary.wiley.com/doi/abs/10.1002/pds.5529</a>, <a class="reference external" href="https://arxiv.org/abs/https://onlinelibrary.wiley.com/doi/pdf/10.1002/pds.5529">arXiv:https://onlinelibrary.wiley.com/doi/pdf/10.1002/pds.5529</a>, <a class="reference external" href="https://doi.org/https://doi.org/10.1002/pds.5529">doi:https://doi.org/10.1002/pds.5529</a>.</p>
</dd>
<dt class="label" id="footcite-barchartsankey"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Chapel Hill Shane Rosanbalm. Getting sankey with bar charts. 2015. URL: <a class="reference external" href="https://www.pharmasug.org/proceedings/2015/DV/PharmaSUG-2015-DV07.pdf">https://www.pharmasug.org/proceedings/2015/DV/PharmaSUG-2015-DV07.pdf</a>.</p>
</dd>
<dt class="label" id="footcite-sasofficialsankey"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Sanjay Matange. Sankey diagrams. 2015. URL: <a class="reference external" href="https://blogs.sas.com/content/graphicallyspeaking/2015/03/21/sankey-diagrams/">https://blogs.sas.com/content/graphicallyspeaking/2015/03/21/sankey-diagrams/</a>.</p>
</dd>
<dt class="label" id="footcite-sankeywithsasandd3js"><span class="brackets"><a class="fn-backref" href="#id4">4</a></span></dt>
<dd><p>Tanmay Khole. Using sankey diagram to analyze drug pipeline. 2020. URL: <a class="reference external" href="https://www.lexjansen.com/phuse-us/2020/dv/DV03.pdf">https://www.lexjansen.com/phuse-us/2020/dv/DV03.pdf</a>.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="2D-KDE.html" class="btn btn-neutral float-left" title="2D-KDE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Multihistogram.html" class="btn btn-neutral float-right" title="MultiHistogram" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SupermanJP.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>